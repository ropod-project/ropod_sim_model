<?xml version="1.0" encoding="UTF-8"?>
<launch>

	<env name="GAZEBO_MODEL_PATH" value="$(find ropod_sim_model)/simulator/models:$(optenv GAZEBO_MODEL_PATH)"/>
	<env name="GAZEBO_RESOURCE_PATH" value="$(find ropod_sim_model)/simulator:$(optenv GAZEBO_RESOURCE_PATH)"/>
        <env name="GAZEBO_PLUGIN_PATH" value="$(env CATKIN_WORKSPACE)/devel/lib:$(optenv GAZEBO_PLUGIN_PATH)"/>

	<!--<env name="GAZEBO_MODEL_DATABASE_URI" value="" /> THIS VARIABLE SHOULD BE CHANGED LOCALLY, 
	see http://cstwiki.wtb.tue.nl/index.php?title=RoPod/Tutorials/GAZEBO_installation_and_interface_with_ROS/Faster statup of Gazebo -->
	
	<arg name="robot" default="pico"/>
	<arg name="model_name" default="pico"/> 
	<arg name="model_path" />
        <arg name="movingObjects" default="false" />
        <arg name="doubleLaser" default="false" />
        <arg name="gui" default="false"/>
        
        <group unless="$(arg movingObjects)">
                <!-- start gazebo server-->
                <node name="gazebo" pkg="gazebo_ros" type="gzserver" args="$(arg model_path)/world/$(arg robot).world" required="true">
                    <param name="pub_clock_frequency" value="true" />
                </node>                
        </group>
        

        <group if="$(arg movingObjects)">
                 <group if="$(arg doubleLaser)">
                        <!-- start gazebo server-->
                        <node name="gazebo" pkg="gazebo_ros" type="gzserver" args="$(arg model_path)/world/$(arg robot)_movingObjects_doubleLaser.world" required="true">
                            <!--<param name="pub_clock_frequency" value="true" />-->
                        </node>      
                </group>
                
                 <group unless="$(arg doubleLaser)">
                        <!-- start gazebo server-->
                       <include file="$(find gazebo_ros)/launch/empty_world.launch">
                                <!--  <arg name="verbose" value="true" /> -->
                                <arg name="world_name" value="$(arg model_path)/world/$(arg robot)_movingObjects.world"/>
                        </include>                          
                </group>
        </group>
	
        <!-- start gazebo client -->
        <group if="$(arg gui)">
            <node name="gazebo_gui" pkg="gazebo_ros" type="gzclient" respawn="false" output="screen"/>
        </group>
       
        
	<node name="throttle" pkg="topic_tools" type="throttle" args="messages /$(arg robot)/laser_sim 20.0 /$(arg robot)/laser/scan" />  
</launch>
